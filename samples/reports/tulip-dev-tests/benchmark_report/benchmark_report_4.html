<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style type="text/css">
    div.histo {
        visibility: hidden
    }
</style>

<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">

    if (window.File && window.FileReader && window.FileList && window.Blob) {
        // Great success! All the File APIs are supported.
    } else {
        alert('The File APIs are not fully supported in this browser.');
    }

    // Load the Visualization API and the corechart package.
    google.load('visualization', '1.0', {'packages':['corechart']});

    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawInitialChart);

    var chartData = null;
    var chart = null;

    function setChartData(names, histos) {
        while (names.length < histos.length) {
            names.push('Unknown');
        }

        var series = [];
        for (var i = 0; i < histos.length; i++) {
            series = appendDataSeries(histos[i], names[i], series);
        }

        chartData = google.visualization.arrayToDataTable(series);
    }


    function drawInitialChart() {
        // Connect the choose files button:
        document.getElementById('files').addEventListener('change', handleFileSelect, false);

        // Load some static example data:
    var data1Str = document.querySelector("div#data_1").innerHTML.trim();
    var data2Str = document.querySelector("div#data_2").innerHTML.trim();
    var data0Str = document.querySelector("div#data_0").innerHTML.trim();
    var histos = [data1Str, data2Str, data0Str];
    var names = ['A1', 'A2', 'S'];
    setChartData(names, histos);
    drawChart();
    }

    var maxPercentile = 1000000;

    function drawChart() {

        var ticks =
                [{v:1,f:'0%'},
                    {v:10,f:'90%'},
                    {v:100,f:'99%'},
                    {v:1000,f:'99.9%'},
                    {v:10000,f:'99.99%'},
                    {v:100000,f:'99.999%'},
                    {v:1000000,f:'99.9999%'},
                    {v:10000000,f:'99.99999%'},
                    {v:100000000,f:'99.999999%'}];

        var unitSelection = document.getElementById("timeUnitSelection");
        var unitSelIndex = unitSelection.selectedIndex;
        var unitText = unitSelection.options[unitSelIndex].innerHTML;

        var options = {
//            title: 'Percentile Response Time Distribution',
            height: 480,
//            hAxis: {title: 'Percentile', minValue: 0, logScale: true, ticks:ticks },
            hAxis: {
                title: "Percentile",
                minValue: 1, logScale: true, ticks:ticks,
                viewWindowMode:'explicit',
                viewWindow:{
                    max:maxPercentile,
                    min:1
                }
            },
            vAxis: {title: 'Latency (' + unitText + ')', minValue: 0 },
            legend: {position: 'bottom'}
        };


        // add tooltips with correct percentile text to data:
        var columns = [0];
        for (var i = 1; i < chartData.getNumberOfColumns(); i++) {
            columns.push(i);
            columns.push({
                type: 'string',
                properties: {
                    role: 'tooltip'
                },
                calc: (function (j) {
                    return function (dt, row) {
                        var percentile = 100.0 - (100.0/dt.getValue(row, 0));
                        return dt.getColumnLabel(j) + ': ' +
                                percentile.toPrecision(7) +
                                '\%\'ile = ' + dt.getValue(row, j) + ' ' + unitText
                    }
                })(i)
            });
        }
        var view = new google.visualization.DataView(chartData);
        view.setColumns(columns);

        chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(view, options);

        google.visualization.events.addListener(chart, 'ready', function () {
            chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        });

    }
</script>
<script type="text/javascript">
    function appendDataSeries(histo, name, dataSeries) {
        var series;
        var seriesCount;
        if (dataSeries.length == 0) {
            series = [ ['X', name] ];
            seriesCount = 1;
        } else {
            series = dataSeries;
            series[0].push(name);
            seriesCount = series[0].length - 1;
        }

        var lines = histo.split("\n");

        var seriesIndex = 1;
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i].trim();
            var values = line.trim().split(/[ ]+/);

            if (line[0] != '#' && values.length == 4) {

                var y = parseFloat(values[0]);
                var x = parseFloat(values[3]);

                if (!isNaN(x) && !isNaN(y)) {

                    if (seriesIndex >= series.length) {
                        series.push([x]);
                    }

                    while (series[seriesIndex].length < seriesCount) {
                        series[seriesIndex].push(null);
                    }

                    series[seriesIndex].push(y);
                    seriesIndex++;
                }
            }
        }

        while (seriesIndex < series.length) {
            series[seriesIndex].push(null);
            seriesIndex++;
        }

        return series;
    }
</script>
<script>
    function timeUnitsSelected(evt) {
        drawChart();
        return {typed: ''};
    }

    function doExport(event) {
        saveSvgAsPng(document.querySelector('svg'), 'Histogram', 2.0);
        return {typed: ''};
    }
</script>

<script>
    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object
        var fileDisplayArea = document.getElementById('fileDisplayArea');

        var names = [];
        var histos = [];

        fileDisplayArea.innerText = "file selected...\n";

        // Loop through the FileList and render image files as thumbnails.
        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();

            reader.onload = (function(theFile) {
                return function(e) {
                    histos.push(e.target.result);
                    names.push(escape(theFile.name));
                    fileDisplayArea.innerText = " Plotting input from: " + names + "\n";
                    setChartData(names, histos);
                    drawChart();
                };
            })(f);

            // Read in the image file as a data URL.
            reader.readAsText(f);
        }

    }

</script>

<script type="text/javascript">
    (function() {
        var out$ = typeof exports != 'undefined' && exports || this;

        var doctype = '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';

        function inlineImages(callback) {
            var images = document.querySelectorAll('svg image');
            var left = images.length;
            if (left == 0) {
                callback();
            }
            for (var i = 0; i < images.length; i++) {
                (function(image) {
                    if (image.getAttribute('xlink:href')) {
                        var href = image.getAttribute('xlink:href').value;
                        if (/^http/.test(href) && !(new RegExp('^' + window.location.host).test(href))) {
                            throw new Error("Cannot render embedded images linking to external hosts.");
                        }
                    }
                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');
                    var img = new Image();
                    img.src = image.getAttribute('xlink:href');
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        image.setAttribute('xlink:href', canvas.toDataURL('image/png'));
                        left--;
                        if (left == 0) {
                            callback();
                        }
                    }
                })(images[i]);
            }
        }

        function styles(dom) {
            var css = "";
            var sheets = document.styleSheets;
            for (var i = 0; i < sheets.length; i++) {
                if (sheets[i].hasOwnProperty('cssRules')) {
                    var rules = sheets[i].cssRules;
                    for (var j = 0; j < rules.length; j++) {
                        var rule = rules[j];
                        if (typeof(rule.style) != "undefined") {
                            css += rule.selectorText + " { " + rule.style.cssText + " }\n";
                        }
                    }
                }
            }

            var s = document.createElement('style');
            s.setAttribute('type', 'text/css');
            s.innerHTML = "<![CDATA[\n" + css + "\n]]>";

            var defs = document.createElement('defs');
            defs.appendChild(s);
            return defs;
        }

        out$.svgAsDataUri = function(el, scaleFactor, cb) {
            scaleFactor = scaleFactor || 1;

            inlineImages(function() {
                var outer = document.createElement("div");
                var clone = el.cloneNode(true);
                var width = parseInt(
                        clone.getAttribute('width')
                        || clone.style.width
                        || out$.getComputedStyle(el).getPropertyValue('width')
                );
                var height = parseInt(
                        clone.getAttribute('height')
                        || clone.style.height
                        || out$.getComputedStyle(el).getPropertyValue('height')
                );

                var xmlns = "http://www.w3.org/2000/xmlns/";

                clone.setAttribute("version", "1.1");
                clone.setAttributeNS(xmlns, "xmlns", "http://www.w3.org/2000/svg");
                clone.setAttributeNS(xmlns, "xmlns:xlink", "http://www.w3.org/1999/xlink");
                clone.setAttribute("width", width * scaleFactor);
                clone.setAttribute("height", height * scaleFactor);
                clone.setAttribute("viewBox", "0 0 " + width + " " + height);
                outer.appendChild(clone);

                clone.insertBefore(styles(clone), clone.firstChild);

                var svg = doctype + outer.innerHTML;
                var uri = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svg)));
                if (cb) {
                    cb(uri);
                }
            });
        }

        out$.saveSvgAsPng = function(el, name, scaleFactor) {
            out$.svgAsDataUri(el, scaleFactor, function(uri) {
                var image = new Image();
                image.src = uri;
                image.onload = function() {
                    var canvas = document.createElement('canvas');
                    canvas.width = image.width;
                    canvas.height = image.height;
                    var context = canvas.getContext('2d');
                    context.drawImage(image, 0, 0);

                    var a = document.createElement('a');
                    a.download = name;
                    a.href = canvas.toDataURL('image/png');
                    document.body.appendChild(a);
                    a.click();
                }
            });
        }
    })();
</script>

<style>
    .slider-width500
    {
        width: 500px;
    }
</style>

</head>

<body>


<h2>Actions per Second</h2>
  <div id="main" style="width: 100%;height:400px;"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/6.0.0/echarts.min.js"></script>
  <script src="benchmark_report_4_t.js"></script>
<h2>Response Times (ms)</h2>
  <div id="main_p" style="width: 100%;height:400px;"></div>
  <script src="benchmark_report_4_p.js"></script>


<h2>Percentile Response Time Distribution</h2>

<input type="file" id="files" name="files[]" multiple />

<pre id="fileDisplayArea">Please select file(s) above.</pre>

<!--Div that will hold the chart-->
<div id="chart_div">None Loaded</div>

Latency time units:
<select name="units" size="1" id="timeUnitSelection" onChange="timeUnitsSelected()">
    <option value="Latency (seconds)">seconds</option>
    <option selected value="Latency (milliseconds)">milliseconds</option>
    <option value="Latency (qs)">microseconds</option>
    <option value="Latency (nanoseconds)">nanoseconds</option>
</select>
<button type='button' onclick='doExport(event)'>Export Image</button>

&nbsp; &nbsp; &nbsp; &nbsp;
<p>
Percentile range:

<input type="range" class="slider-width500"
       min="1" max="8" value="7" step="1"
       width="300px"
       onchange="showValue(this.value)" />
<span id="percentileRange">99.99999%</span>
<script type="text/javascript">
    function showValue(newValue) {
        var x = Math.pow(10, newValue);
        var percentile = 100.0 - (100.0 / x);
        document.getElementById("percentileRange").innerHTML=percentile + "%";
        maxPercentile = x;
        drawChart();
        return {typed: ''};
    }
</script>
</p>

<div id="data_1" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

       0.007 0.000000000000          1           1.00
       1.136 0.100000000000        296           1.11
       2.207 0.200000000000        596           1.25
       3.223 0.300000000000        889           1.43
       5.207 0.400000000000       1240           1.67
       6.211 0.500000000000       1516           2.00
       7.203 0.550000000000       1639           2.22
       7.219 0.600000000000       1775           2.50
       8.207 0.650000000000       1940           2.86
       9.167 0.700000000000       2081           3.33
       9.215 0.750000000000       2238           4.00
      10.127 0.775000000000       2301           4.44
      10.191 0.800000000000       2367           5.00
      10.215 0.825000000000       2462           5.71
      11.127 0.850000000000       2515           6.67
      11.207 0.875000000000       2638           8.00
      11.207 0.887500000000       2638           8.89
      11.215 0.900000000000       2694          10.00
      11.223 0.912500000000       2713          11.43
      11.255 0.925000000000       2737          13.33
      12.135 0.937500000000       2773          16.00
      12.175 0.943750000000       2793          17.78
      12.207 0.950000000000       2867          20.00
      12.207 0.956250000000       2867          22.86
      12.207 0.962500000000       2867          26.67
      12.207 0.968750000000       2867          32.00
      12.215 0.971875000000       2911          35.56
      12.215 0.975000000000       2911          40.00
      12.215 0.978125000000       2911          45.71
      12.215 0.981250000000       2911          53.33
      12.215 0.984375000000       2911          64.00
      12.223 0.985937500000       2935          71.11
      12.223 0.987500000000       2935          80.00
      12.223 0.989062500000       2935          91.43
      12.223 0.990625000000       2935         106.67
      12.223 0.992187500000       2935         128.00
      12.231 0.992968750000       2940         142.22
      12.231 0.993750000000       2940         160.00
      12.239 0.994531250000       2948         182.86
      12.239 0.995312500000       2948         213.33
      12.239 0.996093750000       2948         256.00
      12.239 0.996484375000       2948         284.44
      12.239 0.996875000000       2948         320.00
      12.247 0.997265625000       2952         365.71
      12.247 0.997656250000       2952         426.67
      12.247 0.998046875000       2952         512.00
      12.247 0.998242187500       2952         568.89
      12.255 0.998437500000       2953         640.00
      12.255 0.998632812500       2953         731.43
      12.263 0.998828125000       2955         853.33
      12.263 0.999023437500       2955        1024.00
      12.263 0.999121093750       2955        1137.78
      12.263 0.999218750000       2955        1280.00
      12.263 0.999316406250       2955        1462.86
      12.271 0.999414062500       2956        1706.67
      12.271 0.999511718750       2956        2048.00
      12.271 0.999560546875       2956        2275.56
      12.271 0.999609375000       2956        2560.00
      12.271 0.999658203125       2956        2925.71
      13.879 0.999707031250       2957        3413.33
      13.879 1.000000000000       2957
#[Mean    =        6.239, StdDeviation   =        3.756]
#[Max     =       13.879, Total count    =         2957]
#[Buckets =           22, SubBuckets     =         2048]
</div>
<div id="data_2" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

       0.005 0.000000000000          1           1.00
       2.209 0.100000000000        917           1.11
       5.207 0.200000000000       1822           1.25
       8.223 0.300000000000       2726           1.43
      11.207 0.400000000000       3633           1.67
      14.215 0.500000000000       4534           2.00
      16.175 0.550000000000       4976           2.22
      17.215 0.600000000000       5464           2.50
      19.167 0.650000000000       5885           2.86
      20.207 0.700000000000       6337           3.33
      22.127 0.750000000000       6802           4.00
      22.223 0.775000000000       7064           4.44
      23.215 0.800000000000       7364           5.00
      24.143 0.825000000000       7461           5.71
      24.223 0.850000000000       7729           6.67
      25.215 0.875000000000       8020           8.00
      25.231 0.887500000000       8061           8.89
      26.175 0.900000000000       8149          10.00
      26.207 0.912500000000       8296          11.43
      26.239 0.925000000000       8371          13.33
      27.215 0.937500000000       8661          16.00
      27.215 0.943750000000       8661          17.78
      27.215 0.950000000000       8661          20.00
      27.215 0.956250000000       8661          22.86
      28.095 0.962500000000       8707          26.67
      28.159 0.968750000000       8764          32.00
      28.207 0.971875000000       8951          35.56
      28.207 0.975000000000       8951          40.00
      28.207 0.978125000000       8951          45.71
      28.207 0.981250000000       8951          53.33
      28.207 0.984375000000       8951          64.00
      28.207 0.985937500000       8951          71.11
      28.207 0.987500000000       8951          80.00
      28.207 0.989062500000       8951          91.43
      28.223 0.990625000000       9020         106.67
      28.223 0.992187500000       9020         128.00
      28.223 0.992968750000       9020         142.22
      28.223 0.993750000000       9020         160.00
      28.223 0.994531250000       9020         182.86
      28.223 0.995312500000       9020         213.33
      28.223 0.996093750000       9020         256.00
      28.223 0.996484375000       9020         284.44
      28.223 0.996875000000       9020         320.00
      28.223 0.997265625000       9020         365.71
      28.239 0.997656250000       9034         426.67
      28.239 0.998046875000       9034         512.00
      28.239 0.998242187500       9034         568.89
      28.239 0.998437500000       9034         640.00
      28.239 0.998632812500       9034         731.43
      28.239 0.998828125000       9034         853.33
      28.239 0.999023437500       9034        1024.00
      28.255 0.999121093750       9038        1137.78
      28.255 0.999218750000       9038        1280.00
      28.255 0.999316406250       9038        1462.86
      28.255 0.999414062500       9038        1706.67
      28.255 0.999511718750       9038        2048.00
      28.271 0.999560546875       9041        2275.56
      28.271 0.999609375000       9041        2560.00
      28.271 0.999658203125       9041        2925.71
      28.271 0.999707031250       9041        3413.33
      28.271 0.999755859375       9041        4096.00
      28.271 0.999780273438       9041        4551.11
      28.271 0.999804687500       9041        5120.00
      28.271 0.999829101563       9041        5851.43
      28.271 0.999853515625       9041        6826.67
      28.271 0.999877929688       9041        8192.00
      29.375 0.999890136719       9042        9102.22
      29.375 1.000000000000       9042
#[Mean    =       14.319, StdDeviation   =        8.479]
#[Max     =       29.375, Total count    =         9042]
#[Buckets =           22, SubBuckets     =         2048]
</div>
<div id="data_0" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

       0.005 0.000000000000          1           1.00
       2.165 0.100000000000       1200           1.11
       4.203 0.200000000000       2418           1.25
       6.211 0.300000000000       3641           1.43
       9.119 0.400000000000       4804           1.67
      11.159 0.500000000000       6015           2.00
      12.207 0.550000000000       6786           2.22
      13.215 0.600000000000       7208           2.50
      15.215 0.650000000000       7812           2.86
      17.215 0.700000000000       8421           3.33
      19.215 0.750000000000       9041           4.00
      20.223 0.775000000000       9346           4.44
      21.215 0.800000000000       9674           5.00
      22.207 0.825000000000       9962           5.71
      23.215 0.850000000000      10321           6.67
      24.207 0.875000000000      10629           8.00
      24.223 0.887500000000      10686           8.89
      25.199 0.900000000000      10806          10.00
      25.215 0.912500000000      10977          11.43
      26.175 0.925000000000      11106          13.33
      26.207 0.937500000000      11253          16.00
      26.239 0.943750000000      11328          17.78
      27.167 0.950000000000      11405          20.00
      27.215 0.956250000000      11618          22.86
      27.215 0.962500000000      11618          26.67
      27.231 0.968750000000      11642          32.00
      28.095 0.971875000000      11664          35.56
      28.143 0.975000000000      11710          40.00
      28.191 0.978125000000      11737          45.71
      28.207 0.981250000000      11908          53.33
      28.207 0.984375000000      11908          64.00
      28.207 0.985937500000      11908          71.11
      28.207 0.987500000000      11908          80.00
      28.207 0.989062500000      11908          91.43
      28.207 0.990625000000      11908         106.67
      28.207 0.992187500000      11908         128.00
      28.223 0.992968750000      11977         142.22
      28.223 0.993750000000      11977         160.00
      28.223 0.994531250000      11977         182.86
      28.223 0.995312500000      11977         213.33
      28.223 0.996093750000      11977         256.00
      28.223 0.996484375000      11977         284.44
      28.223 0.996875000000      11977         320.00
      28.223 0.997265625000      11977         365.71
      28.223 0.997656250000      11977         426.67
      28.223 0.998046875000      11977         512.00
      28.239 0.998242187500      11991         568.89
      28.239 0.998437500000      11991         640.00
      28.239 0.998632812500      11991         731.43
      28.239 0.998828125000      11991         853.33
      28.239 0.999023437500      11991        1024.00
      28.239 0.999121093750      11991        1137.78
      28.239 0.999218750000      11991        1280.00
      28.239 0.999316406250      11991        1462.86
      28.255 0.999414062500      11995        1706.67
      28.255 0.999511718750      11995        2048.00
      28.255 0.999560546875      11995        2275.56
      28.255 0.999609375000      11995        2560.00
      28.255 0.999658203125      11995        2925.71
      28.271 0.999707031250      11998        3413.33
      28.271 0.999755859375      11998        4096.00
      28.271 0.999780273438      11998        4551.11
      28.271 0.999804687500      11998        5120.00
      28.271 0.999829101563      11998        5851.43
      28.271 0.999853515625      11998        6826.67
      28.271 0.999877929688      11998        8192.00
      28.271 0.999890136719      11998        9102.22
      28.271 0.999902343750      11998       10240.00
      28.271 0.999914550781      11998       11702.86
      29.375 0.999926757813      11999       13653.33
      29.375 1.000000000000      11999
#[Mean    =       12.327, StdDeviation   =        8.353]
#[Max     =       29.375, Total count    =        11999]
#[Buckets =           22, SubBuckets     =         2048]
</div>
</body>
</html>

