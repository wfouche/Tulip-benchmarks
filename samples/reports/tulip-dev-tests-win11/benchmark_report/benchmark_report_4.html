<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style type="text/css">
    div.histo {
        visibility: hidden
    }
</style>

<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">

    if (window.File && window.FileReader && window.FileList && window.Blob) {
        // Great success! All the File APIs are supported.
    } else {
        alert('The File APIs are not fully supported in this browser.');
    }

    // Load the Visualization API and the corechart package.
    google.load('visualization', '1.0', {'packages':['corechart']});

    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawInitialChart);

    var chartData = null;
    var chart = null;

    function setChartData(names, histos) {
        while (names.length < histos.length) {
            names.push('Unknown');
        }

        var series = [];
        for (var i = 0; i < histos.length; i++) {
            series = appendDataSeries(histos[i], names[i], series);
        }

        chartData = google.visualization.arrayToDataTable(series);
    }


    function drawInitialChart() {
        // Connect the choose files button:
        document.getElementById('files').addEventListener('change', handleFileSelect, false);

        // Load some static example data:
    var data1Str = document.querySelector("div#data_1").innerHTML.trim();
    var data2Str = document.querySelector("div#data_2").innerHTML.trim();
    var data0Str = document.querySelector("div#data_0").innerHTML.trim();
    var histos = [data1Str, data2Str, data0Str];
    var names = ['A1', 'A2', 'S'];
    setChartData(names, histos);
    drawChart();
    }

    var maxPercentile = 1000000;

    function drawChart() {

        var ticks =
                [{v:1,f:'0%'},
                    {v:10,f:'90%'},
                    {v:100,f:'99%'},
                    {v:1000,f:'99.9%'},
                    {v:10000,f:'99.99%'},
                    {v:100000,f:'99.999%'},
                    {v:1000000,f:'99.9999%'},
                    {v:10000000,f:'99.99999%'},
                    {v:100000000,f:'99.999999%'}];

        var unitSelection = document.getElementById("timeUnitSelection");
        var unitSelIndex = unitSelection.selectedIndex;
        var unitText = unitSelection.options[unitSelIndex].innerHTML;

        var options = {
//            title: 'Percentile Response Time Distribution',
            height: 480,
//            hAxis: {title: 'Percentile', minValue: 0, logScale: true, ticks:ticks },
            hAxis: {
                title: "Percentile",
                minValue: 1, logScale: true, ticks:ticks,
                viewWindowMode:'explicit',
                viewWindow:{
                    max:maxPercentile,
                    min:1
                }
            },
            vAxis: {title: 'Latency (' + unitText + ')', minValue: 0 },
            legend: {position: 'bottom'}
        };


        // add tooltips with correct percentile text to data:
        var columns = [0];
        for (var i = 1; i < chartData.getNumberOfColumns(); i++) {
            columns.push(i);
            columns.push({
                type: 'string',
                properties: {
                    role: 'tooltip'
                },
                calc: (function (j) {
                    return function (dt, row) {
                        var percentile = 100.0 - (100.0/dt.getValue(row, 0));
                        return dt.getColumnLabel(j) + ': ' +
                                percentile.toPrecision(7) +
                                '\%\'ile = ' + dt.getValue(row, j) + ' ' + unitText
                    }
                })(i)
            });
        }
        var view = new google.visualization.DataView(chartData);
        view.setColumns(columns);

        chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(view, options);

        google.visualization.events.addListener(chart, 'ready', function () {
            chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        });

    }
</script>
<script type="text/javascript">
    function appendDataSeries(histo, name, dataSeries) {
        var series;
        var seriesCount;
        if (dataSeries.length == 0) {
            series = [ ['X', name] ];
            seriesCount = 1;
        } else {
            series = dataSeries;
            series[0].push(name);
            seriesCount = series[0].length - 1;
        }

        var lines = histo.split("\n");

        var seriesIndex = 1;
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i].trim();
            var values = line.trim().split(/[ ]+/);

            if (line[0] != '#' && values.length == 4) {

                var y = parseFloat(values[0]);
                var x = parseFloat(values[3]);

                if (!isNaN(x) && !isNaN(y)) {

                    if (seriesIndex >= series.length) {
                        series.push([x]);
                    }

                    while (series[seriesIndex].length < seriesCount) {
                        series[seriesIndex].push(null);
                    }

                    series[seriesIndex].push(y);
                    seriesIndex++;
                }
            }
        }

        while (seriesIndex < series.length) {
            series[seriesIndex].push(null);
            seriesIndex++;
        }

        return series;
    }
</script>
<script>
    function timeUnitsSelected(evt) {
        drawChart();
        return {typed: ''};
    }

    function doExport(event) {
        saveSvgAsPng(document.querySelector('svg'), 'Histogram', 2.0);
        return {typed: ''};
    }
</script>

<script>
    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object
        var fileDisplayArea = document.getElementById('fileDisplayArea');

        var names = [];
        var histos = [];

        fileDisplayArea.innerText = "file selected...\n";

        // Loop through the FileList and render image files as thumbnails.
        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();

            reader.onload = (function(theFile) {
                return function(e) {
                    histos.push(e.target.result);
                    names.push(escape(theFile.name));
                    fileDisplayArea.innerText = " Plotting input from: " + names + "\n";
                    setChartData(names, histos);
                    drawChart();
                };
            })(f);

            // Read in the image file as a data URL.
            reader.readAsText(f);
        }

    }

</script>

<script type="text/javascript">
    (function() {
        var out$ = typeof exports != 'undefined' && exports || this;

        var doctype = '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';

        function inlineImages(callback) {
            var images = document.querySelectorAll('svg image');
            var left = images.length;
            if (left == 0) {
                callback();
            }
            for (var i = 0; i < images.length; i++) {
                (function(image) {
                    if (image.getAttribute('xlink:href')) {
                        var href = image.getAttribute('xlink:href').value;
                        if (/^http/.test(href) && !(new RegExp('^' + window.location.host).test(href))) {
                            throw new Error("Cannot render embedded images linking to external hosts.");
                        }
                    }
                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');
                    var img = new Image();
                    img.src = image.getAttribute('xlink:href');
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        image.setAttribute('xlink:href', canvas.toDataURL('image/png'));
                        left--;
                        if (left == 0) {
                            callback();
                        }
                    }
                })(images[i]);
            }
        }

        function styles(dom) {
            var css = "";
            var sheets = document.styleSheets;
            for (var i = 0; i < sheets.length; i++) {
                if (sheets[i].hasOwnProperty('cssRules')) {
                    var rules = sheets[i].cssRules;
                    for (var j = 0; j < rules.length; j++) {
                        var rule = rules[j];
                        if (typeof(rule.style) != "undefined") {
                            css += rule.selectorText + " { " + rule.style.cssText + " }\n";
                        }
                    }
                }
            }

            var s = document.createElement('style');
            s.setAttribute('type', 'text/css');
            s.innerHTML = "<![CDATA[\n" + css + "\n]]>";

            var defs = document.createElement('defs');
            defs.appendChild(s);
            return defs;
        }

        out$.svgAsDataUri = function(el, scaleFactor, cb) {
            scaleFactor = scaleFactor || 1;

            inlineImages(function() {
                var outer = document.createElement("div");
                var clone = el.cloneNode(true);
                var width = parseInt(
                        clone.getAttribute('width')
                        || clone.style.width
                        || out$.getComputedStyle(el).getPropertyValue('width')
                );
                var height = parseInt(
                        clone.getAttribute('height')
                        || clone.style.height
                        || out$.getComputedStyle(el).getPropertyValue('height')
                );

                var xmlns = "http://www.w3.org/2000/xmlns/";

                clone.setAttribute("version", "1.1");
                clone.setAttributeNS(xmlns, "xmlns", "http://www.w3.org/2000/svg");
                clone.setAttributeNS(xmlns, "xmlns:xlink", "http://www.w3.org/1999/xlink");
                clone.setAttribute("width", width * scaleFactor);
                clone.setAttribute("height", height * scaleFactor);
                clone.setAttribute("viewBox", "0 0 " + width + " " + height);
                outer.appendChild(clone);

                clone.insertBefore(styles(clone), clone.firstChild);

                var svg = doctype + outer.innerHTML;
                var uri = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svg)));
                if (cb) {
                    cb(uri);
                }
            });
        }

        out$.saveSvgAsPng = function(el, name, scaleFactor) {
            out$.svgAsDataUri(el, scaleFactor, function(uri) {
                var image = new Image();
                image.src = uri;
                image.onload = function() {
                    var canvas = document.createElement('canvas');
                    canvas.width = image.width;
                    canvas.height = image.height;
                    var context = canvas.getContext('2d');
                    context.drawImage(image, 0, 0);

                    var a = document.createElement('a');
                    a.download = name;
                    a.href = canvas.toDataURL('image/png');
                    document.body.appendChild(a);
                    a.click();
                }
            });
        }
    })();
</script>

<style>
    .slider-width500
    {
        width: 500px;
    }
</style>

</head>

<body>


<h2>Actions per Second</h2>
  <div id="main" style="width: 100%;height:400px;"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/6.0.0/echarts.min.js"></script>
  <script src="benchmark_report_4_t.js"></script>
<h2>Response Times (ms)</h2>
  <div id="main_p" style="width: 100%;height:400px;"></div>
  <script src="benchmark_report_4_p.js"></script>


<h2>Percentile Response Time Distribution</h2>

<input type="file" id="files" name="files[]" multiple />

<pre id="fileDisplayArea">Please select file(s) above.</pre>

<!--Div that will hold the chart-->
<div id="chart_div">None Loaded</div>

Latency time units:
<select name="units" size="1" id="timeUnitSelection" onChange="timeUnitsSelected()">
    <option value="Latency (seconds)">seconds</option>
    <option selected value="Latency (milliseconds)">milliseconds</option>
    <option value="Latency (qs)">microseconds</option>
    <option value="Latency (nanoseconds)">nanoseconds</option>
</select>
<button type='button' onclick='doExport(event)'>Export Image</button>

&nbsp; &nbsp; &nbsp; &nbsp;
<p>
Percentile range:

<input type="range" class="slider-width500"
       min="1" max="8" value="7" step="1"
       width="300px"
       onchange="showValue(this.value)" />
<span id="percentileRange">99.99999%</span>
<script type="text/javascript">
    function showValue(newValue) {
        var x = Math.pow(10, newValue);
        var percentile = 100.0 - (100.0 / x);
        document.getElementById("percentileRange").innerHTML=percentile + "%";
        maxPercentile = x;
        drawChart();
        return {typed: ''};
    }
</script>
</p>

<div id="data_1" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

       0.000 0.000000000000          1           1.00
       2.003 0.100000000000        299           1.11
       3.051 0.200000000000        596           1.25
       4.503 0.300000000000        894           1.43
       5.723 0.400000000000       1191           1.67
       7.035 0.500000000000       1489           2.00
       7.719 0.550000000000       1639           2.22
       8.335 0.600000000000       1788           2.50
       8.975 0.650000000000       1936           2.86
       9.567 0.700000000000       2085           3.33
      10.319 0.750000000000       2235           4.00
      10.751 0.775000000000       2309           4.44
      11.143 0.800000000000       2382           5.00
      11.503 0.825000000000       2458           5.71
      11.887 0.850000000000       2531           6.67
      12.159 0.875000000000       2605           8.00
      12.439 0.887500000000       2645           8.89
      12.535 0.900000000000       2685          10.00
      12.655 0.912500000000       2718          11.43
      12.839 0.925000000000       2754          13.33
      12.999 0.937500000000       2793          16.00
      13.071 0.943750000000       2810          17.78
      13.319 0.950000000000       2829          20.00
      13.519 0.956250000000       2848          22.86
      13.783 0.962500000000       2866          26.67
      14.007 0.968750000000       2885          32.00
      14.375 0.971875000000       2894          35.56
      15.039 0.975000000000       2903          40.00
      15.991 0.978125000000       2912          45.71
      16.831 0.981250000000       2922          53.33
      18.591 0.984375000000       2931          64.00
      19.471 0.985937500000       2936          71.11
      19.679 0.987500000000       2940          80.00
      19.967 0.989062500000       2945          91.43
      21.407 0.990625000000       2950         106.67
      21.855 0.992187500000       2954         128.00
      22.927 0.992968750000       2957         142.22
      23.135 0.993750000000       2959         160.00
      23.279 0.994531250000       2961         182.86
      23.503 0.995312500000       2965         213.33
      23.647 0.996093750000       2966         256.00
      24.127 0.996484375000       2967         284.44
      24.159 0.996875000000       2968         320.00
      24.319 0.997265625000       2969         365.71
      24.687 0.997656250000       2971         426.67
      24.703 0.998046875000       2972         512.00
      24.703 0.998242187500       2972         568.89
      25.135 0.998437500000       2973         640.00
      25.135 0.998632812500       2973         731.43
      25.215 0.998828125000       2974         853.33
      25.359 0.999023437500       2975        1024.00
      25.359 0.999121093750       2975        1137.78
      25.359 0.999218750000       2975        1280.00
      25.359 0.999316406250       2975        1462.86
      25.487 0.999414062500       2976        1706.67
      25.487 0.999511718750       2976        2048.00
      25.487 0.999560546875       2976        2275.56
      25.487 0.999609375000       2976        2560.00
      25.487 0.999658203125       2976        2925.71
      26.319 0.999707031250       2977        3413.33
      26.319 1.000000000000       2977
#[Mean    =        7.197, StdDeviation   =        4.378]
#[Max     =       26.319, Total count    =         2977]
#[Buckets =           22, SubBuckets     =         2048]
</div>
<div id="data_2" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

       0.000 0.000000000000          3           1.00
       3.129 0.100000000000        899           1.11
       6.175 0.200000000000       1799           1.25
       9.055 0.300000000000       2697           1.43
      12.335 0.400000000000       3596           1.67
      15.159 0.500000000000       4495           2.00
      16.623 0.550000000000       4945           2.22
      18.159 0.600000000000       5399           2.50
      19.615 0.650000000000       5846           2.86
      21.279 0.700000000000       6297           3.33
      22.687 0.750000000000       6746           4.00
      23.407 0.775000000000       6974           4.44
      24.047 0.800000000000       7198           5.00
      24.735 0.825000000000       7418           5.71
      25.487 0.850000000000       7643           6.67
      26.175 0.875000000000       7867           8.00
      26.479 0.887500000000       7982           8.89
      26.895 0.900000000000       8092          10.00
      27.263 0.912500000000       8205          11.43
      27.599 0.925000000000       8317          13.33
      27.983 0.937500000000       8429          16.00
      28.111 0.943750000000       8487          17.78
      28.287 0.950000000000       8545          20.00
      28.479 0.956250000000       8603          22.86
      28.623 0.962500000000       8658          26.67
      28.831 0.968750000000       8716          32.00
      28.927 0.971875000000       8739          35.56
      29.007 0.975000000000       8771          40.00
      29.135 0.978125000000       8794          45.71
      29.359 0.981250000000       8823          53.33
      29.519 0.984375000000       8850          64.00
      29.647 0.985937500000       8866          71.11
      29.887 0.987500000000       8881          80.00
      29.999 0.989062500000       8893          91.43
      30.255 0.990625000000       8906         106.67
      30.671 0.992187500000       8922         128.00
      30.735 0.992968750000       8927         142.22
      30.991 0.993750000000       8934         160.00
      31.359 0.994531250000       8941         182.86
      31.647 0.995312500000       8948         213.33
      32.495 0.996093750000       8955         256.00
      32.895 0.996484375000       8959         284.44
      32.991 0.996875000000       8962         320.00
      33.599 0.997265625000       8967         365.71
      34.047 0.997656250000       8970         426.67
      34.207 0.998046875000       8973         512.00
      34.463 0.998242187500       8975         568.89
      34.527 0.998437500000       8976         640.00
      34.591 0.998632812500       8978         731.43
      34.719 0.998828125000       8980         853.33
      35.007 0.999023437500       8982        1024.00
      35.135 0.999121093750       8983        1137.78
      35.135 0.999218750000       8983        1280.00
      35.199 0.999316406250       8984        1462.86
      35.231 0.999414062500       8985        1706.67
      35.263 0.999511718750       8986        2048.00
      35.359 0.999560546875       8987        2275.56
      35.359 0.999609375000       8987        2560.00
      35.359 0.999658203125       8987        2925.71
      35.551 0.999707031250       8988        3413.33
      35.551 0.999755859375       8988        4096.00
      35.583 0.999780273438       8989        4551.11
      35.583 0.999804687500       8989        5120.00
      35.583 0.999829101563       8989        5851.43
      35.583 0.999853515625       8989        6826.67
      35.583 0.999877929688       8989        8192.00
      35.775 0.999890136719       8990        9102.22
      35.775 1.000000000000       8990
#[Mean    =       15.131, StdDeviation   =        8.668]
#[Max     =       35.775, Total count    =         8990]
#[Buckets =           22, SubBuckets     =         2048]
</div>
<div id="data_0" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

       0.000 0.000000000000          4           1.00
       2.587 0.100000000000       1197           1.11
       4.959 0.200000000000       2396           1.25
       7.083 0.300000000000       3592           1.43
       9.287 0.400000000000       4788           1.67
      11.847 0.500000000000       5984           2.00
      12.999 0.550000000000       6582           2.22
      14.519 0.600000000000       7185           2.50
      16.383 0.650000000000       7780           2.86
      18.303 0.700000000000       8377           3.33
      20.271 0.750000000000       8980           4.00
      21.391 0.775000000000       9278           4.44
      22.383 0.800000000000       9574           5.00
      23.247 0.825000000000       9880           5.71
      24.079 0.850000000000      10175           6.67
      25.039 0.875000000000      10473           8.00
      25.503 0.887500000000      10621           8.89
      25.935 0.900000000000      10771          10.00
      26.399 0.912500000000      10926          11.43
      26.911 0.925000000000      11072          13.33
      27.407 0.937500000000      11220          16.00
      27.599 0.943750000000      11294          17.78
      27.871 0.950000000000      11377          20.00
      28.079 0.956250000000      11448          22.86
      28.287 0.962500000000      11522          26.67
      28.511 0.968750000000      11594          32.00
      28.623 0.971875000000      11635          35.56
      28.735 0.975000000000      11669          40.00
      28.895 0.978125000000      11709          45.71
      29.007 0.981250000000      11748          53.33
      29.215 0.984375000000      11781          64.00
      29.359 0.985937500000      11800          71.11
      29.455 0.987500000000      11820          80.00
      29.615 0.989062500000      11837          91.43
      29.887 0.990625000000      11858         106.67
      30.095 0.992187500000      11874         128.00
      30.255 0.992968750000      11883         142.22
      30.527 0.993750000000      11893         160.00
      30.703 0.994531250000      11902         182.86
      30.991 0.995312500000      11911         213.33
      31.439 0.996093750000      11921         256.00
      31.647 0.996484375000      11925         284.44
      32.351 0.996875000000      11930         320.00
      32.831 0.997265625000      11935         365.71
      32.991 0.997656250000      11939         426.67
      33.599 0.998046875000      11944         512.00
      34.047 0.998242187500      11947         568.89
      34.207 0.998437500000      11950         640.00
      34.271 0.998632812500      11951         731.43
      34.527 0.998828125000      11953         853.33
      34.623 0.999023437500      11956        1024.00
      34.719 0.999121093750      11957        1137.78
      34.783 0.999218750000      11958        1280.00
      35.007 0.999316406250      11959        1462.86
      35.135 0.999414062500      11960        1706.67
      35.231 0.999511718750      11962        2048.00
      35.231 0.999560546875      11962        2275.56
      35.263 0.999609375000      11963        2560.00
      35.263 0.999658203125      11963        2925.71
      35.359 0.999707031250      11964        3413.33
      35.551 0.999755859375      11965        4096.00
      35.551 0.999780273438      11965        4551.11
      35.551 0.999804687500      11965        5120.00
      35.551 0.999829101563      11965        5851.43
      35.583 0.999853515625      11966        6826.67
      35.583 0.999877929688      11966        8192.00
      35.583 0.999890136719      11966        9102.22
      35.583 0.999902343750      11966       10240.00
      35.583 0.999914550781      11966       11702.86
      35.775 0.999926757813      11967       13653.33
      35.775 1.000000000000      11967
#[Mean    =       13.157, StdDeviation   =        8.543]
#[Max     =       35.775, Total count    =        11967]
#[Buckets =           22, SubBuckets     =         2048]
</div>
</body>
</html>

