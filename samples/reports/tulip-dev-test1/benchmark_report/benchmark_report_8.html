<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style type="text/css">
    div.histo {
         display: none
    }
</style>

<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">

    if (window.File && window.FileReader && window.FileList && window.Blob) {
        // Great success! All the File APIs are supported.
    } else {
        alert('The File APIs are not fully supported in this browser.');
    }

    // Load the Visualization API and the corechart package.
    google.load('visualization', '1.0', {'packages':['corechart']});

    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawInitialChart);

    var chartData = null;
    var chart = null;

    function setChartData(names, histos) {
        while (names.length < histos.length) {
            names.push('Unknown');
        }

        var series = [];
        for (var i = 0; i < histos.length; i++) {
            series = appendDataSeries(histos[i], names[i], series);
        }

        chartData = google.visualization.arrayToDataTable(series);
    }


    function drawInitialChart() {
        // Connect the choose files button:
        document.getElementById('files').addEventListener('change', handleFileSelect, false);

        // Load some static example data:
    var data1Str = document.querySelector("div#data_1").innerHTML.trim();
    var histos = [data1Str];
    var names = ['A100'];
    setChartData(names, histos);
    drawChart();
    }

    var maxPercentile = 1000000;

    function drawChart() {

        var ticks =
                [{v:1,f:'0%'},
                    {v:10,f:'90%'},
                    {v:100,f:'99%'},
                    {v:1000,f:'99.9%'},
                    {v:10000,f:'99.99%'},
                    {v:100000,f:'99.999%'},
                    {v:1000000,f:'99.9999%'},
                    {v:10000000,f:'99.99999%'},
                    {v:100000000,f:'99.999999%'}];

        var unitSelection = document.getElementById("timeUnitSelection");
        var unitSelIndex = unitSelection.selectedIndex;
        var unitText = unitSelection.options[unitSelIndex].innerHTML;

        var options = {
//            title: 'Percentile Response Time Distribution',
            height: 480,
//            hAxis: {title: 'Percentile', minValue: 0, logScale: true, ticks:ticks },
            hAxis: {
                title: "Percentile",
                minValue: 1, logScale: true, ticks:ticks,
                viewWindowMode:'explicit',
                viewWindow:{
                    max:maxPercentile,
                    min:1
                }
            },
            vAxis: {title: 'Latency (' + unitText + ')', minValue: 0 },
            legend: {position: 'bottom'}
        };


        // add tooltips with correct percentile text to data:
        var columns = [0];
        for (var i = 1; i < chartData.getNumberOfColumns(); i++) {
            columns.push(i);
            columns.push({
                type: 'string',
                properties: {
                    role: 'tooltip'
                },
                calc: (function (j) {
                    return function (dt, row) {
                        var percentile = 100.0 - (100.0/dt.getValue(row, 0));
                        return dt.getColumnLabel(j) + ': ' +
                                percentile.toPrecision(7) +
                                '\%\'ile = ' + dt.getValue(row, j) + ' ' + unitText
                    }
                })(i)
            });
        }
        var view = new google.visualization.DataView(chartData);
        view.setColumns(columns);

        chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(view, options);

        google.visualization.events.addListener(chart, 'ready', function () {
            chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        });

    }
</script>
<script type="text/javascript">
    function appendDataSeries(histo, name, dataSeries) {
        var series;
        var seriesCount;
        if (dataSeries.length == 0) {
            series = [ ['X', name] ];
            seriesCount = 1;
        } else {
            series = dataSeries;
            series[0].push(name);
            seriesCount = series[0].length - 1;
        }

        var lines = histo.split("\n");

        var seriesIndex = 1;
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i].trim();
            var values = line.trim().split(/[ ]+/);

            if (line[0] != '#' && values.length == 4) {

                var y = parseFloat(values[0]);
                var x = parseFloat(values[3]);

                if (!isNaN(x) && !isNaN(y)) {

                    if (seriesIndex >= series.length) {
                        series.push([x]);
                    }

                    while (series[seriesIndex].length < seriesCount) {
                        series[seriesIndex].push(null);
                    }

                    series[seriesIndex].push(y);
                    seriesIndex++;
                }
            }
        }

        while (seriesIndex < series.length) {
            series[seriesIndex].push(null);
            seriesIndex++;
        }

        return series;
    }
</script>
<script>
    function timeUnitsSelected(evt) {
        drawChart();
        return {typed: ''};
    }

    function doExport(event) {
        saveSvgAsPng(document.querySelector('svg'), 'Histogram', 2.0);
        return {typed: ''};
    }
</script>

<script>
    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object
        var fileDisplayArea = document.getElementById('fileDisplayArea');

        var names = [];
        var histos = [];

        fileDisplayArea.innerText = "file selected...\n";

        // Loop through the FileList and render image files as thumbnails.
        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();

            reader.onload = (function(theFile) {
                return function(e) {
                    histos.push(e.target.result);
                    names.push(escape(theFile.name));
                    fileDisplayArea.innerText = " Plotting input from: " + names + "\n";
                    setChartData(names, histos);
                    drawChart();
                };
            })(f);

            // Read in the image file as a data URL.
            reader.readAsText(f);
        }

    }

</script>

<script type="text/javascript">
    (function() {
        var out$ = typeof exports != 'undefined' && exports || this;

        var doctype = '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';

        function inlineImages(callback) {
            var images = document.querySelectorAll('svg image');
            var left = images.length;
            if (left == 0) {
                callback();
            }
            for (var i = 0; i < images.length; i++) {
                (function(image) {
                    if (image.getAttribute('xlink:href')) {
                        var href = image.getAttribute('xlink:href').value;
                        if (/^http/.test(href) && !(new RegExp('^' + window.location.host).test(href))) {
                            throw new Error("Cannot render embedded images linking to external hosts.");
                        }
                    }
                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');
                    var img = new Image();
                    img.src = image.getAttribute('xlink:href');
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        image.setAttribute('xlink:href', canvas.toDataURL('image/png'));
                        left--;
                        if (left == 0) {
                            callback();
                        }
                    }
                })(images[i]);
            }
        }

        function styles(dom) {
            var css = "";
            var sheets = document.styleSheets;
            for (var i = 0; i < sheets.length; i++) {
                if (sheets[i].hasOwnProperty('cssRules')) {
                    var rules = sheets[i].cssRules;
                    for (var j = 0; j < rules.length; j++) {
                        var rule = rules[j];
                        if (typeof(rule.style) != "undefined") {
                            css += rule.selectorText + " { " + rule.style.cssText + " }\n";
                        }
                    }
                }
            }

            var s = document.createElement('style');
            s.setAttribute('type', 'text/css');
            s.innerHTML = "<![CDATA[\n" + css + "\n]]>";

            var defs = document.createElement('defs');
            defs.appendChild(s);
            return defs;
        }

        out$.svgAsDataUri = function(el, scaleFactor, cb) {
            scaleFactor = scaleFactor || 1;

            inlineImages(function() {
                var outer = document.createElement("div");
                var clone = el.cloneNode(true);
                var width = parseInt(
                        clone.getAttribute('width')
                        || clone.style.width
                        || out$.getComputedStyle(el).getPropertyValue('width')
                );
                var height = parseInt(
                        clone.getAttribute('height')
                        || clone.style.height
                        || out$.getComputedStyle(el).getPropertyValue('height')
                );

                var xmlns = "http://www.w3.org/2000/xmlns/";

                clone.setAttribute("version", "1.1");
                clone.setAttributeNS(xmlns, "xmlns", "http://www.w3.org/2000/svg");
                clone.setAttributeNS(xmlns, "xmlns:xlink", "http://www.w3.org/1999/xlink");
                clone.setAttribute("width", width * scaleFactor);
                clone.setAttribute("height", height * scaleFactor);
                clone.setAttribute("viewBox", "0 0 " + width + " " + height);
                outer.appendChild(clone);

                clone.insertBefore(styles(clone), clone.firstChild);

                var svg = doctype + outer.innerHTML;
                var uri = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svg)));
                if (cb) {
                    cb(uri);
                }
            });
        }

        out$.saveSvgAsPng = function(el, name, scaleFactor) {
            out$.svgAsDataUri(el, scaleFactor, function(uri) {
                var image = new Image();
                image.src = uri;
                image.onload = function() {
                    var canvas = document.createElement('canvas');
                    canvas.width = image.width;
                    canvas.height = image.height;
                    var context = canvas.getContext('2d');
                    context.drawImage(image, 0, 0);

                    var a = document.createElement('a');
                    a.download = name;
                    a.href = canvas.toDataURL('image/png');
                    document.body.appendChild(a);
                    a.click();
                }
            });
        }
    })();
</script>

<style>
    .slider-width500
    {
        width: 500px;
    }
</style>

</head>

<body>


<h2>Actions per Second</h2>
  <div id="main" style="width: 100%;height:400px;"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/6.0.0/echarts.min.js"></script>
  <script src="benchmark_report_8_t.js"></script>
<h2>Response Times (ms)</h2>
  <div id="main_p" style="width: 100%;height:400px;"></div>
  <script src="benchmark_report_8_p.js"></script>


<h2>Percentile Response Time Distribution</h2>

<input type="file" id="files" name="files[]" multiple />

<pre id="fileDisplayArea">Please select file(s) above.</pre>

<!--Div that will hold the chart-->
<div id="chart_div">None Loaded</div>

Latency time units:
<select name="units" size="1" id="timeUnitSelection" onChange="timeUnitsSelected()">
    <option value="Latency (seconds)">seconds</option>
    <option selected value="Latency (milliseconds)">milliseconds</option>
    <option value="Latency (qs)">microseconds</option>
    <option value="Latency (nanoseconds)">nanoseconds</option>
</select>
<button type='button' onclick='doExport(event)'>Export Image</button>

&nbsp; &nbsp; &nbsp; &nbsp;
<p>
Percentile range:

<input type="range" class="slider-width500"
       min="1" max="8" value="7" step="1"
       width="300px"
       onchange="showValue(this.value)" />
<span id="percentileRange">99.99999%</span>
<script type="text/javascript">
    function showValue(newValue) {
        var x = Math.pow(10, newValue);
        var percentile = 100.0 - (100.0 / x);
        document.getElementById("percentileRange").innerHTML=percentile + "%";
        maxPercentile = x;
        drawChart();
        return {typed: ''};
    }
</script>
</p>

<div id="data_1" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

     100.159 0.000000000000          3           1.00
     100.159 0.100000000000          3           1.11
     100.223 0.200000000000          4           1.25
     100.287 0.300000000000          8           1.43
     100.287 0.400000000000          8           1.67
     100.287 0.500000000000          8           2.00
     100.351 0.550000000000          9           2.22
     100.415 0.600000000000         10           2.50
     100.927 0.650000000000         11           2.86
     100.991 0.700000000000         12           3.33
     100.991 0.750000000000         12           4.00
     101.055 0.775000000000         13           4.44
     101.055 0.800000000000         13           5.00
     101.247 0.825000000000         15           5.71
     101.247 0.850000000000         15           6.67
     101.247 0.875000000000         15           8.00
     101.247 0.887500000000         15           8.89
     101.247 0.900000000000         15          10.00
     101.247 0.912500000000         15          11.43
     101.247 0.925000000000         15          13.33
     101.247 0.937500000000         15          16.00
     101.759 0.943750000000         16          17.78
     101.759 1.000000000000         16
#[Mean    =      100.584, StdDeviation   =        0.491]
#[Max     =      101.759, Total count    =           16]
#[Buckets =           22, SubBuckets     =         2048]
</div>
<div id="data_0" class="histo">
       Value     Percentile TotalCount 1/(1-Percentile)

     100.159 0.000000000000          3           1.00
     100.159 0.100000000000          3           1.11
     100.223 0.200000000000          4           1.25
     100.287 0.300000000000          8           1.43
     100.287 0.400000000000          8           1.67
     100.287 0.500000000000          8           2.00
     100.351 0.550000000000          9           2.22
     100.415 0.600000000000         10           2.50
     100.927 0.650000000000         11           2.86
     100.991 0.700000000000         12           3.33
     100.991 0.750000000000         12           4.00
     101.055 0.775000000000         13           4.44
     101.055 0.800000000000         13           5.00
     101.247 0.825000000000         15           5.71
     101.247 0.850000000000         15           6.67
     101.247 0.875000000000         15           8.00
     101.247 0.887500000000         15           8.89
     101.247 0.900000000000         15          10.00
     101.247 0.912500000000         15          11.43
     101.247 0.925000000000         15          13.33
     101.247 0.937500000000         15          16.00
     101.759 0.943750000000         16          17.78
     101.759 1.000000000000         16
#[Mean    =      100.584, StdDeviation   =        0.491]
#[Max     =      101.759, Total count    =           16]
#[Buckets =           22, SubBuckets     =         2048]
</div>

<style>
table, th, td {
  border:1px solid black; font-size:16px; text-align: center;
}
mark {
  background-color: LightGray;
  color: black;
}
</style>

<h2>Percentile Response Time Distribution (HDR)</h2>
<table style="width:800px">
  <tr>
    <th>Value</th>
    <th>Percentile</th>
    <th>TotalCount</th>
    <th>1/(1-Percentile)</th>
    <th>AboveCount</th>
  </tr>
  <tr>
    <td>101.759 ms</td>
    <td>1.000000000000</td>
    <td>16</td>
    <td></td>
    <td>0</td>
  </tr>
  <tr>
    <td>101.759 ms</td>
    <td>0.943750000000</td>
    <td>16</td>
    <td>17.78</td>
    <td>0</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.937500000000</td>
    <td>15</td>
    <td>16.00</td>
    <td>1</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.925000000000</td>
    <td>15</td>
    <td>13.33</td>
    <td>1</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.912500000000</td>
    <td>15</td>
    <td>11.43</td>
    <td>1</td>
  </tr>
  <tr>
    <td><mark>101.247 ms</mark></td>
    <td><mark>0.900000000000</mark></td>
    <td>15</td>
    <td>10.00</td>
    <td>1</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.887500000000</td>
    <td>15</td>
    <td>8.89</td>
    <td>1</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.875000000000</td>
    <td>15</td>
    <td>8.00</td>
    <td>1</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.850000000000</td>
    <td>15</td>
    <td>6.67</td>
    <td>1</td>
  </tr>
  <tr>
    <td>101.247 ms</td>
    <td>0.825000000000</td>
    <td>15</td>
    <td>5.71</td>
    <td>1</td>
  </tr>
  <tr>
    <td><mark>101.055 ms</mark></td>
    <td><mark>0.800000000000</mark></td>
    <td>13</td>
    <td>5.00</td>
    <td>3</td>
  </tr>
  <tr>
    <td>101.055 ms</td>
    <td>0.775000000000</td>
    <td>13</td>
    <td>4.44</td>
    <td>3</td>
  </tr>
  <tr>
    <td>100.991 ms</td>
    <td>0.750000000000</td>
    <td>12</td>
    <td>4.00</td>
    <td>4</td>
  </tr>
  <tr>
    <td>100.991 ms</td>
    <td>0.700000000000</td>
    <td>12</td>
    <td>3.33</td>
    <td>4</td>
  </tr>
  <tr>
    <td>100.927 ms</td>
    <td>0.650000000000</td>
    <td>11</td>
    <td>2.86</td>
    <td>5</td>
  </tr>
  <tr>
    <td>100.415 ms</td>
    <td>0.600000000000</td>
    <td>10</td>
    <td>2.50</td>
    <td>6</td>
  </tr>
  <tr>
    <td>100.351 ms</td>
    <td>0.550000000000</td>
    <td>9</td>
    <td>2.22</td>
    <td>7</td>
  </tr>
  <tr>
    <td><mark>100.287 ms</mark></td>
    <td><mark>0.500000000000</mark></td>
    <td>8</td>
    <td>2.00</td>
    <td>8</td>
  </tr>
  <tr>
    <td>100.287 ms</td>
    <td>0.400000000000</td>
    <td>8</td>
    <td>1.67</td>
    <td>8</td>
  </tr>
  <tr>
    <td>100.287 ms</td>
    <td>0.300000000000</td>
    <td>8</td>
    <td>1.43</td>
    <td>8</td>
  </tr>
  <tr>
    <td>100.223 ms</td>
    <td>0.200000000000</td>
    <td>4</td>
    <td>1.25</td>
    <td>12</td>
  </tr>
  <tr>
    <td>100.159 ms</td>
    <td>0.100000000000</td>
    <td>3</td>
    <td>1.11</td>
    <td>13</td>
  </tr>
  <tr>
    <td>100.159 ms</td>
    <td>0.000000000000</td>
    <td>3</td>
    <td>1.00</td>
    <td>13</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>avg: 100.584 ms</td>
    <td>sd: 0.491 ms</td>
    <td>p90: 101.247 ms</td>
    <td>p95: 101.759 ms</td>
    <td>p99: 101.759 ms</td>
  </tr>
</table>

<h2>Percentile Response Time Distribution (LLQ)</h2>

<table style="width:800px">
  <tr>
    <th>Value</th>
    <th>Percentile</th>
    <th>Total Count</th>
    <th>Bucket Size</th>
    <th>Percentage</th>
    <th>Above Count</th>
  </tr>
  <tr>
    <td> 100.0 ms</td>
    <td>1.000000</td>
    <td>16</td>
    <td>16</td>
    <td><mark>100.000</mark></td>
    <td>0</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>avg:  100.0 ms</td>
    <td>sd:  &lt; 20 ns</td>
    <td>p50:  100.0 ms</td>
    <td>p90:  100.0 ms</td>
    <td>p95:  100.0 ms</td>
    <td>p99:  100.0 ms</td>
  </tr>

</table>

